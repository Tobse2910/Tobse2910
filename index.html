<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projekte - Portfolio</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1>Über Mich:</h1>
      <p class="lead">Aktuelle Projekte und Web‑Demos von kicodebyts.com</p>
    </div>
  </header>

  <main class="container">
    <nav class="toc" aria-label="Inhaltsverzeichnis">
      <h2>Inhaltsverzeichnis</h2>
      <ul id="toc-list"></ul>
    </nav>

    <section class="projects" id="projects">
      <!-- Karten werden per JS geladen -->
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
  <p>© <span id="year"></span> — <a id="site-link" href="https://kicodebyts.com">kicodebyts.com</a></p>
    </div>
  </footer>

  <script>
    // Interaktives Script: lädt Projektdaten, baut kategorisiertes TOC und Karten
    async function loadProjects(){
      try{
        const res = await fetch('data/projects.json');
        const data = await res.json();
        const projects = Array.isArray(data) ? data : (data.projects || []);

        // Kategorie-Logik basierend auf Tags (einfach erweiterbar)
        function getCategory(p){
          const tags = (p.tags || []).map(t => String(t).toLowerCase());
          if(tags.some(t=>/template|design|webseite|website/.test(t))) return 'Webdesign & Templates';
          if(tags.some(t=>/security|cyber|shield|monitoring/.test(t))) return 'Security & Monitoring';
          if(tags.some(t=>/event|dj|party|matcher/.test(t))) return 'Events & Tools';
          if(tags.some(t=>/weather|wetter|api/.test(t))) return 'Utilities';
          if(tags.some(t=>/ai|analyse|analysis|pdf/.test(t))) return 'AI & Analyse';
          if(tags.some(t=>/scrum|ticket|webapp|web|realtime/.test(t))) return 'Webapps';
          return 'Sonstiges';
        }

        const categories = {};
        projects.forEach(p => {
          const cat = getCategory(p);
          p._category = cat;
          categories[cat] = categories[cat] || [];
          categories[cat].push(p);
        });

        // Render TOC: gruppierte Sektionen, Filter-Buttons
        const toc = document.getElementById('toc-list');
        toc.innerHTML = '';

        // Alle anzeigen Button
        const allLi = document.createElement('li');
        allLi.className = 'toc-all';
        allLi.innerHTML = `<button class="toc-filter active" data-cat="all">Alle (${projects.length})</button>`;
        toc.appendChild(allLi);

        Object.keys(categories).forEach(cat => {
          const items = categories[cat];
          const li = document.createElement('li');
          li.className = 'toc-section';
          const header = document.createElement('div');
          header.className = 'toc-header';
          header.innerHTML = `<button class="toc-toggle" data-cat="${cat}">${cat}</button><span class="toc-count">${items.length}</span>`;
          li.appendChild(header);

          const ul = document.createElement('ul');
          ul.className = 'toc-items';
          items.forEach(p => {
            const item = document.createElement('li');
            item.innerHTML = `<a href="#${p.id}" data-id="${p.id}">${p.title}</a>`;
            ul.appendChild(item);
          });
          li.appendChild(ul);
          toc.appendChild(li);
        });

        // Render cards grid
        const container = document.getElementById('projects');
        container.innerHTML = '';
        projects.forEach(p => {
          const card = document.createElement('article');
          card.className = 'card';
          card.id = p.id;
          card.dataset.cat = p._category;
          card.innerHTML = `
            <div class="card-media"> 
              <img src="${p.image}" alt="${p.title}"> 
            </div>
            <div class="card-body">
              <h3>${p.title}</h3>
              <p class="desc">${p.description || ''}</p>
              <div class="meta"> 
                <span>${(p.tags||[]).join(' · ')}</span>
                <a class="visit" href="${p.url}" target="_blank" rel="noopener noreferrer">Zur Seite</a>
              </div>
            </div>`;
          container.appendChild(card);
        });

        // Event: Filter Buttons
        function applyFilter(cat){
          if(cat === 'all'){
            document.querySelectorAll('.card').forEach(c => c.style.display = '');
          } else {
            document.querySelectorAll('.card').forEach(c => {
              c.style.display = (c.dataset.cat === cat) ? '' : 'none';
            });
          }
        }

        document.querySelectorAll('.toc-toggle, .toc-filter').forEach(btn => {
          btn.addEventListener('click', e => {
            const cat = e.currentTarget.dataset.cat;
            applyFilter(cat);
            document.querySelectorAll('.toc-toggle, .toc-filter').forEach(b => b.classList.toggle('active', b.dataset.cat === cat));
          });
        });

        // Smooth-scroll for links + highlight
        document.querySelectorAll('.toc-items a').forEach(a => {
          a.addEventListener('click', e => {
            e.preventDefault();
            const id = a.dataset.id;
            const el = document.getElementById(id);
            if(!el) return;
            el.scrollIntoView({behavior:'smooth', block:'center'});
            document.querySelectorAll('.card').forEach(c => c.classList.remove('highlight'));
            el.classList.add('highlight');
            setTimeout(()=> el.classList.remove('highlight'), 2600);
          });
        });

        // Collapsible TOC sections
        document.querySelectorAll('.toc-section .toc-toggle').forEach(btn => {
          btn.addEventListener('click', e => {
            const section = btn.closest('.toc-section');
            section.classList.toggle('open');
          });
        });

        // Create tag badges inside cards
        document.querySelectorAll('.card').forEach(card => {
          const tagsText = card.querySelector('.meta span')?.textContent || '';
          if(!tagsText) return;
          const wrap = document.createElement('div');
          wrap.className = 'badges';
          tagsText.split('·').map(s => s.trim()).filter(Boolean).forEach((t,i)=>{
            const b = document.createElement('div'); b.className = 'badge' + (i===0? ' accent':''); b.textContent = t; wrap.appendChild(b);
          });
          card.querySelector('.card-body').insertBefore(wrap, card.querySelector('.meta'));
        });

        // Reveal animation: intersection observer with stagger
        const cards = Array.from(document.querySelectorAll('.card'));
        const io = new IntersectionObserver((entries) => {
          entries.forEach(ent => {
            if(ent.isIntersecting){
              const idx = cards.indexOf(ent.target);
              setTimeout(()=> ent.target.classList.add('visible'), idx*80);
              io.unobserve(ent.target);
            }
          });
        },{threshold:0.12});
        cards.forEach(c => io.observe(c));

        // Footer & year
        document.getElementById('year').textContent = new Date().getFullYear();
        const siteLink = document.getElementById('site-link');
        if(!Array.isArray(data) && data.site) siteLink.href = data.site;

      } catch(err){
        console.error('Fehler beim Laden der Projektdaten', err);
        document.getElementById('projects').innerHTML = '<p>Projektdaten konnten nicht geladen werden.</p>';
      }
    }
    loadProjects();

    // Karten-Interaktion: 3D-tilt, image-parallax und shine
    function initCardInteractions(){
      const cards = document.querySelectorAll('.card');
      cards.forEach(card => {
        let rect = null;
        function onMove(e){
          rect = rect || card.getBoundingClientRect();
          const x = (e.clientX - rect.left) / rect.width;
          const y = (e.clientY - rect.top) / rect.height;
          const tiltX = (y - 0.5) * 10; // rotateX
          const tiltY = (x - 0.5) * -12; // rotateY
          card.style.transform = `perspective(900px) rotateX(${tiltX}deg) rotateY(${tiltY}deg) translateZ(0)`;
          card.classList.add('tilted');
          // image parallax
          const img = card.querySelector('.card-media img');
          if(img) img.style.transform = `translate(${(x-0.5)*6}px, ${(y-0.5)*6}px) scale(1.02)`;
        }
        function onEnter(e){ rect = null; card.classList.add('interactive'); }
        function onLeave(){ card.style.transform = ''; card.classList.remove('tilted'); const img = card.querySelector('.card-media img'); if(img) img.style.transform=''; }
        card.addEventListener('mousemove', onMove);
        card.addEventListener('mouseenter', onEnter);
        card.addEventListener('mouseleave', onLeave);
        // shine on click
        card.addEventListener('click', ()=>{
          card.classList.remove('shine');
          // reflow
          void card.offsetWidth;
          card.classList.add('shine');
          setTimeout(()=> card.classList.remove('shine'), 1000);
        });
      });
    }

    // initialize interactions after slight delay (after DOM is ready & cards rendered)
    setTimeout(()=> initCardInteractions(), 350);
  </script>
</body>
</html>
